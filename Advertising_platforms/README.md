#  Сервис рекламных площадок

производительный веб-сервис для подбора рекламных площадок по заданной локации с учетом иерархии локаций.

##  Описание

Сервис позволяет загружать данные о рекламных площадках из текстового файла и искать подходящие площадки для конкретной локации с учетом вложенности. Реализован с использованием современных практик разработки на .NET 8.

##  Ключевые особенности

Высокая производительность**: Оптимизированный алгоритм поиска с кэшированием
Потокобезопасность: Полная поддержка многопоточности
Структурированная обработка ошибок: Иерархия исключений с детальными сообщениями
Валидация данных: Строгая проверка входных данных
Логирование: Подробное логирование всех операций
Тестирование: Полное покрытие юнит- и интеграционными тестами
Документация API: Автоматическая генерация Swagger документации

##  Архитектура

### Модели данных
Location: Иммутабельная модель локации с валидацией и методами для работы с иерархией
AdvertisingPlatform: Модель рекламной площадки с проверкой активности в локации
LocationSearchRequest/Respons: DTO для API запросов и ответов

### Сервисы
AdvertisingPlatformService: Основной сервис с потокобезопасным хранением и кэшированием
IAdvertisingPlatformService: Интерфейс для инверсии зависимостей

### Исключения
AdvertisingPlatformException: Базовое исключение
AdvertisingValidationException: Ошибки валидации
AdvertisingFileLoadException: Ошибки загрузки файлов
AdvertisingInvalidDataException: Ошибки некорректных данных

##  API Endpoints

### 1. Загрузка рекламных площадок
```http
POST /api/AdvertisingPlatform/upload
Content-Type: multipart/form-data

Параметры:
- file: текстовый файл (.txt) с данными о рекламных площадках
```

**Ответ:**
```
{
  "message": "Данные успешно загружены",
  "fileName": "test.txt",
  "fileSize": 1024,
  "totalPlatforms": 4,
  "totalLocations": 8,
  "timestamp": "2024-01-01T12:00:00Z"
}
```

### 2. Поиск рекламных площадок (POST)
```
POST /api/AdvertisingPlatform/search
Content-Type: application/json

{
  "location": "/ru/msk"
}
```

### 3. Поиск рекламных площадок (GET)
```
GET /api/AdvertisingPlatform/search/{location}

Пример: GET /api/AdvertisingPlatform/search/%2Fru%2Fmsk
```

**Ответ:**
```
{
  "location": "/ru/msk",
  "advertisingPlatforms": ["Яндекс.Директ", "Газета уральских москвичей"],
  "totalCount": 2,
  "searchTimestamp": "2024-01-01T12:00:00Z"
}
```

### 4. Статистика данных
```
GET /api/AdvertisingPlatform/stats
```

### 5. Очистка данных
```
DELETE /api/AdvertisingPlatform/clear
```

## Формат данных

Текстовый файл должен содержать строки в формате:
```
Название площадки:локация1,локация2,локация3
```

### Пример файла:
```
Яндекс.Директ:/ru
Ревдинский рабочий:/ru/svrd/revda,/ru/svrd/pervik
Газета уральских москвичей:/ru/msk,/ru/permobl,/ru/chelobl
Крутая реклама:/ru/svrd
```

### Валидация локаций:
 Формат: `/[a-zA-Z0-9/_-]+`
 Регистр не учитывается
 Поддерживается иерархическая структура

## Логика поиска

Сервис учитывает вложенность локаций:
 Для локации `/ru/msk` подходят: "Газета уральских москвичей" и "Яндекс.Директ"
 Для локации `/ru/svrd` подходят: "Яндекс.Директ" и "Крутая реклама"
 Для локации `/ru/svrd/revda` подходят: "Яндекс.Директ", "Ревдинский рабочий" и "Крутая реклама"
 Для локации `/ru` подходит только "Яндекс.Директ"

##  Техничка

### Производительность
In-memory хранени: Все данные в оперативной памяти
Кэширование: Автоматическое кэширование результатов поиска (5 минут)
Потокобезопасность: ReaderWriterLockSlim для конкурентного доступа

### Безопасность
Валидация файлов: Проверка размера (макс. 10MB) и формата
Валидация данны: Строгая проверка входных параметров
Обработка ошибок: Детальные сообщения об ошибках без утечки информации

### Надежность
Отказоустойчивостб: Корректная обработка некорректных данных: Структурированное логирование всех операций
Мониторинг: Метрики производительности и статистика

##  Запуск проекта

### Требования
- .NET 8.0 SDK

### Установка и запуск
# Клонирование репозитория
git clone <repository-url>
cd Advertising_platforms

# Восстановление зависимостей
dotnet restore

# Сборка проекта
dotnet build

# Запуск приложения
dotnet run
```

### Доступ к API
- **Swagger UI**: http://localhost:5150/swagger
- **API Base URL**: http://localhost:5150/api/AdvertisingPlatform

##  Тестирование
### Запуск тестов
```
# Все тесты
dotnet test

# С подробным выводом
dotnet test --logger "console;verbosity=detailed"

# Покрытие кода (требует coverlet.collector)
dotnet test --collect:"XPlat Code Coverage"


### Переменные окружения
- `ASPNETCORE_ENVIRONMENT`: Production/Development
- `ASPNETCORE_URLS`: URL для привязки

### Структура проекта
```
Advertising_platforms/
├── Controllers/           # API контроллеры
├── Models/               # Модели данных
├── Services/             # Бизнес-логика
├── Exceptions/           # Исключения
├── Tests/                # Тесты
├── Properties/           # Конфигурация
└── README.md            # Документация
```